# ========================================
# Dionaea Configuration
# ========================================
# LEARNING: This YAML file controls what services
# Dionaea emulates and how it logs attacks
# ========================================

# Logging configuration
logging:
  version: 1
  
  formatters:
    default:
      format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
  
  handlers:
    console:
      class: logging.StreamHandler
      formatter: default
    
    file:
      class: logging.FileHandler
      filename: /opt/dionaea/var/dionaea/log/dionaea.log
      formatter: default
  
  root:
    level: INFO
    handlers: [console, file]

# ========================================
# Services Configuration
# ========================================

# FTP Service
# LEARNING: FTP is commonly exploited for malware distribution
services:
  ftp:
    enabled: true
    port: 21
    # Emulate vsftpd (common FTP server)
    banner: "220 FTP Server ready\r\n"
    max_attempts: 3
    # Fake accounts to accept
    accounts:
      - username: "ftp"
        password: "ftp"
      - username: "anonymous"
        password: ""

  # HTTP Service
  # LEARNING: Catches web exploits, shellshock, etc.
  http:
    enabled: true
    port: 80
    # Emulate common web servers
    server_header: "Apache/2.4.41 (Ubuntu)"
    root: /opt/dionaea/var/dionaea/wwwroot
    # Capture POST data (malware uploads)
    capture_uploads: true

  # HTTPS Service
  https:
    enabled: true
    port: 443
    ssl_cert: /opt/dionaea/etc/dionaea/ssl/dionaea.crt
    ssl_key: /opt/dionaea/etc/dionaea/ssl/dionaea.key

  # SMB Service
  # LEARNING: Critical for catching ransomware and worms
  smb:
    enabled: true
    port: 445
    # Emulate Windows Server
    server_name: "SRV2019"
    workgroup: "WORKGROUP"
    # Share configuration
    shares:
      - name: "ADMIN$"
        comment: "Remote Admin"
      - name: "C$"
        comment: "Default share"
      - name: "IPC$"
        comment: "Remote IPC"

  # MSSQL Service
  # LEARNING: Catches SQL injection and database attacks
  mssql:
    enabled: true
    port: 1433
    version: "Microsoft SQL Server 2019"

  # MySQL Service
  mysql:
    enabled: true
    port: 3306
    version: "5.7.33-0ubuntu0.18.04.1"

  # SIP Service (VoIP)
  # LEARNING: Less common but catches VoIP exploitation
  sip:
    enabled: true
    port: 5060

  # TFTP Service
  tftp:
    enabled: true
    port: 69

# ========================================
# Downloads Configuration
# ========================================
downloads:
  # Where to store captured malware
  dir: /opt/dionaea/var/dionaea/binaries
  
  # Temporary directory for processing
  tmp: /opt/dionaea/var/dionaea/tmp
  
  # Maximum file size (10MB)
  max_size: 10485760

# ========================================
# Malware Analysis
# ========================================
processors:
  # Shellcode detection using libemu
  # LEARNING: Identifies shellcode in exploits
  # DISABLED: libemu not available in Ubuntu 22.04
  libemu:
    enabled: false
  
  # VirusTotal submission (optional)
  virustotal:
    enabled: false
    # Uncomment and add key in production
    # api_key: "YOUR_VT_API_KEY"

# ========================================
# Logging and Output
# ========================================
outputs:
  # SQLite database for local storage
  sqlite:
    enabled: true
    file: /opt/dionaea/var/dionaea/dionaea.db
  
  # JSON log file
  # LEARNING: This is what Filebeat will ship to Logstash
  jsonlog:
    enabled: true
    file: /opt/dionaea/var/dionaea/log/dionaea.json
  
  # HTTP incident reporter (optional)
  http_report:
    enabled: false

# ========================================
# LEARNING: Dionaea Attack Lifecycle
# ========================================
# 1. Attacker scans for open port (e.g., 445 SMB)
# 2. Dionaea responds with emulated service banner
# 3. Attacker sends exploit attempt
# 4. Dionaea captures the payload
# 5. If payload is shellcode, libemu analyzes it
# 6. Malware binary is stored in binaries/
# 7. Event is logged to JSON
# 8. Filebeat ships to Logstash
# 9. Backend correlates with other attacks
# 10. Dashboard shows malware family, origin, TTPs
#
# Example: WannaCry Detection
# - Scans port 445 (SMB)
# - Sends EternalBlue exploit
# - Dionaea captures payload
# - Stores as SHA256 hash
# - We can submit to VT, analyze, create signature
# - Block at network edge before it hits production
# ========================================
